<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng</title>
<style>
Â  body { font-family:"Segoe UI",Arial,sans-serif; background:linear-gradient(120deg,#fff8dc,#ffe4e6); text-align:center; margin:0; padding:20px;}
Â  h1 { color:#6d28d9; }
Â  #game-container { background:white; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.15); display:inline-block; padding:20px; max-width:500px; width:100%; }
Â  img { max-width:100%; border-radius:15px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
Â  button { padding:10px 20px; border:none; border-radius:10px; margin:5px; background-color:#7c3aed; color:white; font-weight:bold; cursor:pointer; transition:0.3s;}
Â  button:hover { background-color:#5b21b6;}
Â  select, input { padding:10px; border-radius:8px; border:1px solid #ccc; width:80%; margin-top:5px; margin-bottom:10px;}
Â  #result{font-size:18px;font-weight:bold;margin-top:15px;}
Â  #score{font-size:18px;font-weight:bold;color:#16a34a;margin-top:10px;}
Â  #timer{font-size:18px;font-weight:bold;color:#dc2626;margin-bottom:10px;}
Â  table { width:100%; border-collapse:collapse; margin-top:15px; overflow-x: auto;} /* ThÃªm overflow-x cho báº£ng */
Â  th, td { border:1px solid #ccc; padding:8px; font-size:14px;}
Â  th { background:#7c3aed; color:white;}
</style>
</head>
<body>

<h1>ğŸ­ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng</h1>

<div id="menu">
Â  <h3>Nháº­p tÃªn cá»§a báº¡n:</h3>
Â  <input type="text" id="playerName" placeholder="Nháº­p tÃªn...">
Â  <h2>Chá»n cháº¿ Ä‘á»™ chÆ¡i</h2>
Â  <button onclick="startGame('sanpham')">ğŸ¥¯ Sáº£n pháº©m</button>
Â  <button onclick="startGame('baobi1')">ğŸ“¦ Bao bÃ¬ cáº¥p 1</button>
Â  <button onclick="startGame('baobi2')">ğŸ“¦ Bao bÃ¬ cáº¥p 2</button>
</div>

<div id="game-container" style="display:none;">
Â  <div id="timer">Thá»i gian: 20s</div>
Â  <img id="biscuitImage" src="" alt="áº¢nh lá»—i QC">
Â  <div>
Â  Â  <button onclick="checkAnswer(true)">âœ… Äáº¡t</button>
Â  Â  <button onclick="checkAnswer(false)">âŒ Lá»—i</button>
Â  </div>

Â  <div id="errorSection" style="display:none;">
Â  Â  <p>Chá»n loáº¡i lá»—i:</p>
Â  Â  <select id="errorSelect"></select>
Â  Â  <br>
Â  Â  <button onclick="submitError()">XÃ¡c nháº­n</button>
Â  </div>

Â  <div id="result"></div>
Â  <div id="score">Äiá»ƒm: 0</div>
Â  <br>
Â  <button onclick="nextImage()">ğŸ‘‰ áº¢nh tiáº¿p theo</button>
</div>

<script>
// --- Cáº¥u hÃ¬nh ---
const baseURL = "Anh/"; // ThÆ° má»¥c áº£nh trÃªn GitHub
// >>>>>> THAY URL WEB APP Má»šI Cá»¦A Báº N VÃ€O ÄÃ‚Y <<<<<<
const scriptURL = "https://script.google.com/macros/s/AKfycbzg9GjEfNdqNm0_tVuMj-CoCDRCLcj3L8XgXDKqTSQZHL0uMpIxI8PCvRav-LjjBYfJ/exec"; 

// --- Dá»¯ liá»‡u hÃ¬nh áº£nh (Giá»¯ nguyÃªn) ---
const productErrors = [
Â  { src:"Banh_Be_Vo.webp", correctError:"BÃ¡nh bá»ƒ vá»¡" },
Â  { src:"Banh_Khuyet.webp", correctError:"BÃ¡nh khuyáº¿t" },
Â  { src:"Banh_Loi_Cong_Dau.webp", correctError:"BÃ¡nh cong Ä‘áº§u" },
Â  { src:"Banh_Loi_Dinh_Nhau.webp", correctError:"BÃ¡nh dÃ­nh nhau" },
Â  { src:"Banh_Loi_Khong_Dau.webp", correctError:"BÃ¡nh khÃ´ng dáº§u" },
Â  { src:"Banh_Mau_Sac_Khong_Dat.webp", correctError:"MÃ u sáº¯c khÃ´ng Ä‘áº¡t" },
Â  { src:"Banh_Rop_Mat.webp", correctError:"Rá»™p máº·t" },
Â  { src:"Banh_Sut_Mat_Mieng.webp", correctError:"Sá»©t máº¥t miáº¿ng" }
];

const pack1Errors = [
Â  { src:"Sai_Date_Code.webp", correctError:"Sai date code" },
Â  { src:"Bang_Keo_Noi_Cuon.webp", correctError:"BÄƒng keo ná»‘i cuá»™n" },
Â  { src:"Can_Trang.webp", correctError:"Cáº¥n tráº¯ng" },
Â  { src:"Duong_Han_Bi_Hu_Hai.webp", correctError:"ÄÆ°á»ng hÃ n bá»‹ hÆ° háº¡i" },
Â  { src:"Duong_Han_Can_Rach.webp", correctError:"ÄÆ°á»ng hÃ n cáº¥n rÃ¡ch" },
Â  { src:"Duong_Han_Qua_Nhiet.webp", correctError:"ÄÆ°á»ng hÃ n quÃ¡ nhiá»‡t" },
Â  { src:"Duong_Han_Yeu.webp", correctError:"ÄÆ°á»ng hÃ n yáº¿u" },
Â  { src:"Xep_Ly.webp", correctError:"Xáº¿p ly" },
Â  { src:"Xep_Ly_xi.webp", correctError:"Xáº¿p ly xá»‰" },
Â  { src:"Kep_Banh_Duong_Han.webp", correctError:"Káº¹p bÃ¡nh Ä‘Æ°á»ng hÃ n" },
Â  { src:"Lech_Bao_Bi.webp", correctError:"Lá»‡ch bao bÃ¬" }
];

const pack2Errors = [
Â  { src:"Bang_Keo_Nhan_Khong_Du_chieu_dai.webp", correctError:"BÄƒng keo nhÄƒn khÃ´ng Ä‘á»§ chiá»u dÃ i" },
Â  { src:"Hop_Bung_Keo.webp", correctError:"Há»™p bung keo" },
Â  { src:"Hop_Dan_Tho_Tai.webp", correctError:"Há»™p dÃ¡n thÃ² tai" },
Â  { src:"Hop_Lem_Keo.webp", correctError:"Há»™p lem keo" },
Â  { src:"Khe_Ho_Nap_Thung.webp", correctError:"Khe há»Ÿ náº¯p thÃ¹ng" },
Â  { src:"Lech_Nap_Thung.webp", correctError:"Lá»‡ch náº¯p thÃ¹ng" },
Â  { src:"Mop_Gay_Hop.webp", correctError:"MÃ³p gÃ£y há»™p" },
Â  { src:"Rach_Goc_Hop.webp", correctError:"RÃ¡ch gÃ³c há»™p" },
Â  { src:"Sai_Date_Thung.webp", correctError:"Sai date thÃ¹ng" },
Â  { src:"Sai_Quy_Cach_Xep.webp", correctError:"Sai quy cÃ¡ch xáº¿p" },
Â  { src:"Thieu_Banh.webp", correctError:"Thiáº¿u bÃ¡nh" },
Â  { src:"Thieu_Thung_Tren_Palet.webp", correctError:"Thiáº¿u thÃ¹ng trÃªn pallet" },
Â  { src:"Thung_Mop_Meo.webp", correctError:"ThÃ¹ng mÃ³p mÃ©o" },
Â  { src:"Tray_Xuoc_Hop.webp", correctError:"Tray xÆ°á»›c há»™p" },
Â  { src:"Hop_Bi_Ho.webp", correctError:"Há»™p bá»‹ há»Ÿ" },
Â  { src:"Dan_Lech.webp", correctError:"DÃ¡n lá»‡ch" }
];

const errorOptions = {
Â  sanpham: productErrors.map(e=>e.correctError),
Â  baobi1: pack1Errors.map(e=>e.correctError),
Â  baobi2: pack2Errors.map(e=>e.correctError)
};

// --- Biáº¿n toÃ n cá»¥c (Giá»¯ nguyÃªn) ---
let images=[], mode="", current=0, score=0, answered=false, timeLeft=20, timerInterval, playerName="";
const imgElement=document.getElementById("biscuitImage");
const resultElement=document.getElementById("result");
const errorSection=document.getElementById("errorSection");
const scoreElement=document.getElementById("score");
const timerElement=document.getElementById("timer");
const menu=document.getElementById("menu");
const gameContainer=document.getElementById("game-container");
const errorSelect=document.getElementById("errorSelect");

// --- HÃ m trá»™n máº£ng (Giá»¯ nguyÃªn) ---
function shuffleArray(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}

// --- Báº¯t Ä‘áº§u game (Cáº­p nháº­t cache-buster) ---
function startGame(selectedMode){
Â  playerName=document.getElementById("playerName").value.trim();
Â  if(!playerName){alert("HÃ£y nháº­p tÃªn trÆ°á»›c khi chÆ¡i!");return;}
Â  mode=selectedMode;
Â  const baseErrors= mode==="sanpham"?productErrors: mode==="baobi1"?pack1Errors:pack2Errors;
Â  const timestamp = "?v=" + Date.now(); // Cache-buster
Â  
Â  images=baseErrors.map(img=>({...img, src: baseURL+img.src+timestamp, isGood:false}));
Â  images.push({src:baseURL+"Banh_Dat_1.webp"+timestamp, isGood:true});
Â  images.push({src:baseURL+"Banh_Dat_2.webp"+timestamp, isGood:true});
Â  shuffleArray(images);
Â  images.forEach(img=>{const i=new Image();i.src=img.src;});
Â  
Â  menu.style.display="none";
Â  gameContainer.style.display="block";
Â  loadErrorOptions();
Â  loadImage();
}

// --- Load options lá»—i (Giá»¯ nguyÃªn) ---
function loadErrorOptions(){
Â  errorSelect.innerHTML="<option value=''>-- Chá»n loáº¡i lá»—i --</option>";
Â  errorOptions[mode].forEach(opt=>{
Â  Â  const option=document.createElement("option");
Â  Â  option.value=opt; option.textContent=opt;
Â  Â  errorSelect.appendChild(option);
Â  });
}

// --- Timer (ThÃªm chuyá»ƒn áº£nh khi háº¿t giá») ---
function startTimer(){
Â  timerElement.textContent=`Thá»i gian: ${timeLeft}s`;
Â  timerInterval=setInterval(()=>{
Â  Â  timeLeft--;
Â  Â  timerElement.textContent=`Thá»i gian: ${timeLeft}s`;
Â  Â  if(timeLeft<=0){
Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  resultElement.textContent="â° Háº¿t thá»i gian!";
Â  Â  Â  answered=true;
Â  Â  Â  errorSection.style.display="none";
Â  Â  Â  setTimeout(nextImage, 1500); // Chá» 1.5s rá»“i chuyá»ƒn áº£nh
Â  Â  }
Â  },1000);
}

// --- Kiá»ƒm tra Ä‘Ã¡p Ã¡n (Giá»¯ nguyÃªn) ---
function checkAnswer(isGoodSelected){
Â  if(answered) return;
Â  const currentImg=images[current];
Â  if(currentImg.isGood && isGoodSelected){resultElement.textContent="ğŸ‰ ChÃ­nh xÃ¡c! ÄÃ¢y lÃ  sáº£n pháº©m Ä‘áº¡t!";score++;scoreElement.textContent="Äiá»ƒm: "+score;answered=true;clearInterval(timerInterval);}
Â  else if(!currentImg.isGood && !isGoodSelected){resultElement.textContent="â— ÄÃ¢y lÃ  lá»—i, hÃ£y chá»n loáº¡i lá»—i!";errorSection.style.display="block";}
Â  else {resultElement.textContent="âŒ Sai rá»“i!";errorSection.style.display="none";}
}

// --- XÃ¡c nháº­n lá»—i (Giá»¯ nguyÃªn) ---
function submitError(){
Â  const selected=errorSelect.value;
Â  const currentImg=images[current];
Â  if(!selected){ resultElement.textContent="âš ï¸ HÃ£y chá»n loáº¡i lá»—i!"; return;}
Â  if(selected===currentImg.correctError){ resultElement.textContent="âœ… ChÃ­nh xÃ¡c! Báº¡n Ä‘Ã£ xÃ¡c Ä‘á»‹nh Ä‘Ãºng loáº¡i lá»—i.";score++;}Â 
Â  else { resultElement.textContent="âŒ Sai loáº¡i lá»—i.";}
Â  scoreElement.textContent="Äiá»ƒm: "+score;
Â  answered=true;
Â  errorSection.style.display="none";
Â  clearInterval(timerInterval);
}

// --- áº¢nh tiáº¿p theo (Giá»¯ nguyÃªn) ---
function nextImage(){
Â  if(current<images.length-1){ current++; loadImage();}Â 
Â  else { showFinalScore();}
}

// --- Load áº£nh (Giá»¯ nguyÃªn) ---
function loadImage(){
Â  const currentImg=images[current];
Â  imgElement.src=currentImg.src;
Â  resultElement.textContent="";
Â  errorSection.style.display="none";
Â  errorSelect.value="";
Â  answered=false;
Â  clearInterval(timerInterval);
Â  timeLeft=20;
Â  startTimer();
}

// --- HÃ m Hiá»ƒn thá»‹ káº¿t quáº£ vÃ  xáº¿p háº¡ng (Cáº¬P NHáº¬T Sá»¬ Dá»¤NG XHR) ---
async function showFinalScore(){
Â  clearInterval(timerInterval);
Â  gameContainer.innerHTML=`<h2>ğŸ‰ HoÃ n thÃ nh!</h2><p>Äiá»ƒm cá»§a báº¡n: <strong>${score}/${images.length}</strong></p><p>Äang lÆ°u káº¿t quáº£ vÃ  táº£i xáº¿p háº¡ng...</p>`;
Â  
Â  let ranking = [];

Â  try {
Â  Â  // 1. POST Ä‘iá»ƒm báº±ng XHR (ÄÃ¡ng tin cáº­y hÆ¡n fetch)
    await new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', scriptURL);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(xhr.responseText);
            } else {
                reject(new Error(`POST HTTP Error: ${xhr.status}`));
            }
        };
        xhr.onerror = () => reject(new Error('Lá»—i máº¡ng khi lÆ°u Ä‘iá»ƒm.'));
        
        const dataToSend = JSON.stringify({action:"save",ten_nguoi_choi:playerName,muc_choi:mode,diem:score});
        xhr.send(dataToSend);
    });

Â  Â  // Chá» 0.5 giÃ¢y trÆ°á»›c khi GET
Â  Â  await new Promise(r=>setTimeout(r,500));

Â  Â  // 2. GET báº£ng xáº¿p háº¡ng báº±ng XHR
    ranking = await new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', scriptURL + "?action=getRanking");
        xhr.onload = function() {
            if (xhr.status === 200) {
                try {
                    // Cá»‘ gáº¯ng phÃ¢n tÃ­ch pháº£n há»“i JSON
                    resolve(JSON.parse(xhr.responseText));
                } catch (e) {
                    reject(new Error("Lá»—i phÃ¢n tÃ­ch JSON tá»« GAS."));
                }
            } else {
                reject(new Error(`GET HTTP Error: ${xhr.status}`));
            }
        };
        xhr.onerror = () => reject(new Error('Lá»—i máº¡ng khi táº£i xáº¿p háº¡ng.'));
        xhr.send();
    });

Â  Â  // 3. Hiá»ƒn thá»‹ báº£ng xáº¿p háº¡ng
Â  Â  let tableHTML=`<h3>ğŸ† Báº£ng xáº¿p háº¡ng TOP 10</h3>
Â  Â  Â  <table><tr><th>Háº¡ng</th><th>TÃªn</th><th>Má»¥c chÆ¡i</th><th>Äiá»ƒm</th></tr>`;
Â  Â  
    if (Array.isArray(ranking)) { 
        ranking.slice(0,10).forEach((r,i)=>{
            tableHTML+=`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.mode}</td><td>${r.score}</td></tr>`;
        });
    } else {
        tableHTML += `<tr><td colspan='4'>KhÃ´ng cÃ³ dá»¯ liá»‡u xáº¿p háº¡ng hoáº·c dá»¯ liá»‡u khÃ´ng há»£p lá»‡.</td></tr>`;
    }

Â  Â  tableHTML+="</table><br><button onclick='location.reload()'>ğŸ”„ ChÆ¡i láº¡i</button>";

Â  Â  gameContainer.innerHTML=`<h2>ğŸ‰ HoÃ n thÃ nh!</h2>
Â  Â  Â  <p>Äiá»ƒm cá»§a báº¡n: <strong>${score}/${images.length}</strong></p>
Â  Â  Â  ${tableHTML}`;

Â  } catch(err){
    // Hiá»ƒn thá»‹ lá»—i rÃµ rÃ ng hÆ¡n
    gameContainer.innerHTML = `<h2>ğŸ‰ HoÃ n thÃ nh!</h2>
        <p>Äiá»ƒm cá»§a báº¡n: <strong>${score}/${images.length}</strong></p>
        <p>âš ï¸ Lá»—i khi táº£i xáº¿p háº¡ng: <strong>${err.message}</strong></p>
        <p>Vui lÃ²ng kiá»ƒm tra láº¡i URL vÃ  quyá»n truy cáº­p Web App (pháº£i lÃ  'Anyone').</p>
        <button onclick='location.reload()'>ğŸ”„ ChÆ¡i láº¡i</button>`;
    console.error("Lá»—i chi tiáº¿t:", err);
Â  }
}
</script>
</body>
</html>

